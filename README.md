# :headphones: MOOD
**M**usic **O**ptimized for **O**n-road **D**riving<br>주행 중 감정과 고개 움직임을 분석한 음악 최적화 시스템
<br>
<br>
한국공학대학교 컴퓨터공학부 졸업작품 팀 ***FELICITY***​<br>(공덕규, 정이슬, 장인선, 최민근)

----------------------------------------------------------

## :white_medium_square: 프로젝트 소개
**차량 운전자 등 사용자의 감정 및 고개 움직임 인식을 기반으로 맞춤형 음악을 추천하고 운전 집중도를 파악하는 프로젝트**
 - 사용자의 감정을 인식해 분석한 후 적절한 음악을 자동으로 추천하여 편안한 운전을 지원함
   
 - 카메라를 통해 수집된 감정과 움직임 데이터는 서버로 전송되며, 이를 분석한 후 스마트폰을 통해 추천 음악을 제공함
  
 - 사용자의 고개 움직임을 인식해 분석한 후 운전 집중도를 파악하고, 집중도가 낮을 경우 경고창과 경고음을 발생시켜 집중도를 높임

----------------------------------------------------------

# :white_medium_square: 프로젝트 개요

### 주제 선정 배경
 - 고속도로에서 사망사고 원인 중 70%가 주시 태만이며, 끼어들기와 같은 운전자 순간의 감정의 변동으로 발생하는 보복 운전의 발생 건수도 높은 결과를 보임
  
 - 한편 선호하는 음악의 청취는 기분을 개선해주며, 무음 상태일때보다 심박수를 감소해준다는 연구결과를 보이고, 음악을 들으면 효율성과 집중력이 높아지는 효과가 있을 뿐만아니라 운전 중 음악을 듣는것은 스트레스 감소에 도움을 준다고 함
   
 - 때문에 교통사고율 감소를 위한 방안으로 ‘음악’이라는 수단을 사용하고자함

### 연구 및 개발 목표
운전자의 **감정 및 고개 움직임 데이터**를 ​분류 • 분석한 후 안전한 운전을 지원하는 ​**운전 집중도 향상 및 맞춤형 음악 추천** 앱 서비스​ 개발하는 것을 목표로 함

### 연구 개발 효과
 - 운전자 감정 인식을 기반으로 그에 맞는 음악을 추천하여 **감정 상태 조절에 도움**을 주고자 함
  
 - 운전자 고개 움직임 인식을 기반으로 하여 **운전 집중도 향상에 도움**을 주고자 함​

----------------------------------------------------------
## :white_medium_square: 기능
### 시스템 수행 시나리오
![수행 시나리오](https://github.com/user-attachments/assets/8348422e-f26d-4a7e-af88-acc4c58dab89)

### 시스템 구성도
![시스템 구성도](https://github.com/user-attachments/assets/f91dfe63-3009-45e8-a1bc-4a55e15a32ef)

### 시스템 모듈 구성도
![SW 모듈 구성도](https://github.com/user-attachments/assets/a0ef9b2b-190d-44db-a852-fedadf3019d2)

### 모듈 상세 설계(기능별로)
#### :bulb: Jetson Nano & 카메라 인터페이스
**1. 운전자 얼굴 인식/분석**
< 기능 > ​
- 이미지 캡처 후 입력받은 ID로 Amazon S3 버킷에 등록​
- Amazon S3 버킷 : "felicity-mood/faces/입력받은 ID/" 경로에 저장​
- AWS boto3 기반의 얼굴 인식/분석 알고리즘을 활용​
<br>

< 다루는 정보 >​
- 캡처 이미지 ​
- 바운딩 박스 : 얼굴을 둘러싼 바운딩 박스의 좌표​
- 얼굴 랜드마크 : 눈 위치 등 얼굴의 주요 특징점에 대한 x 및 y 좌표​
- 얼굴 일치 배열 : 각 일치 얼굴에 대한 유사도 점수​
- 입력받은 ID : 사용자 구분을 위한 텍스트 정보
<br>

< 시점 >​
- 얼굴 인식: 로그인 및 회원가입 시
<br>

**2. 감정 인식/분석**
< 기능 >​
- 캡처한 이미지를 AWS Rekognition SDK 호출하여 감정 분석​
- AWS boto3 기반의 감정 인식/분석 알고리즘을 활용
<br>


< 다루는 정보 >​
- 캡처 이미지​
- JPEG로 인코딩 후 바이트 배열로 변환​
- 감정 분석 : 행복, 슬픔 등 8가지 감정 상태를 감지하여 신뢰도 반환​ -> 각 감정의 신뢰도를 정규화 하여 백분율로 변환(JSON 형식)
<br>

 < 시점 >​
 - 감정 분석: 매번 하나의 음악 재생이 끝날 시
<br>


**3. 집중도 인식/분석**​
< 기능 >​
ㆍ얼굴 기울기(Pitch(상하), Roll(좌우)), 양쪽 눈 높이를 고려한 집중도 측정​
ㆍ설정 임계값 이하로 3초 동안 집중도가 낮아지면 레벨에 따른 알림을 제공​
ㆍ경고 단계: 경고 -> 주의 -> 위험

< 다루는 정보 >​
ㆍ웹캠 프레임: 실시간 영상 획득 및 분석​
ㆍ머리, 눈 움직임: 얼굴 방향(Pitch, Roll)과 양쪽 눈 높이 변화량 저장 및 분석​

< 시점 >​
ㆍ집중도 인식/분석: 실시간​
ㆍ경고 발생: 임계값 이하 3초 지속 시​
ㆍ경고 해제: 집중도가 일정 기준 이상으로 복구될 때 

**4. 집중도 인식/분석​ (알고리즘)**
< 적용 알고리즘 >​
ㆍ실시간 영상 스트리밍: OpenCV를 활용한 영상 프레임 처리
ㆍ얼굴 기울기 추적​
 - Mediapipe FaceMesh를 이용해 얼굴 랜드마크(눈, 코, 입) 검출​
 - 3D 공간상의 회전 벡터(cv2.solvePnP())를 이용하여 Pitch, Roll 계산​
 - 눈, 코, 입 위치 기반으로 얼굴 위치 추적​
ㆍ눈의 높이 변화 분석​
 - 좌우 눈의 중심 좌표를 계산하여 y축 변화량 측정

![집중도 분석 알고리즘](https://github.com/user-attachments/assets/2acec557-ce86-4444-b93a-53ce0f7e2bec)

#### :bulb: [ Server ]
**운전자 등록/인증**
< 기능 >​
ㆍ등록 : 입력받은 ID와 회원 정보를 바탕으로 회원가입​
ㆍ인증: AWS Rekognition 얼굴 비교 결과로 반환된 ID를 이용해 로그인​

< 다루는 정보 >​
ㆍ입력받은 ID : 사용자 구분을 위한 텍스트 정보​
ㆍ회원정보 : 사용자 이름, 차종, 선호 취향(장르, 아티스트)​
ㆍ반환된 ID : Amazon S3 버킷에 등록된 ID(사용자 등록 시 입력받은 ID)​

**감정 분석 결과**
< 기능 >​
ㆍ감정 분석 함수 호출 시 감정별 신뢰도를 출력​
ㆍ감정 신뢰도 기준으로 내림차순 정렬 후 상위 3가지 감정 저장​

< 다루는 정보 >​
ㆍuser_id: 운전자 고유 식별자​
ㆍemotions: 상위 3가지 감정 텍스트

**집중도 레벨**
< 기능 >​
ㆍ얼굴 기울기(Pitch, Roll) 및 양쪽 눈 y좌표 움직임 기반으로 집중도 측정​
ㆍ실시간 분석하여 기준 이하 집중도 발생 시 경고 제공

< 다루는 정보 >​
ㆍuser_id: 운전자 고유 식별자​
ㆍaxis: 얼굴 기울기 정보 (Pitch, Roll)​
ㆍfocus_level: 집중도 레벨

**음악 추천 알고리즘**
< 기능 >​
ㆍ감정 분석 정보를 이용하여 음악을 추천​
ㆍ음악 검색 : 쿼리 기능을 이용하여 트랙, 플레이리스트를 검색​
ㆍ음악 추가 : 검색된 트랙, 플레이리스트를 감정 카테고리 플레이리스트에 추가​
ㆍ음악 재생 제어 : 재생, 일시 정지, 다음 곡/이전 곡 넘기기 기능

< 다루는 정보 >​
ㆍAWS Rekognition 감정 분석 정보​
ㆍuser 테이블 내 user_id 정보​
ㆍemotion 테이블 내 emotion_name에 할당된 태그 정보​
 - Spotify 내에서 검색 가능한 태그를 미리 설정​
ㆍSpotify 내 사용자의 트랙, 플레이리스트 정보

< 음악을 추천하는 시점 >​
ㆍ매 음악 재생이 끝나고 감정 분석이 이루어지는 시점

![음악 추천 알고리즘](https://github.com/user-attachments/assets/9a9e2ba6-6148-448f-a8e4-8c9fccc20362)

#### :bulb: [ Phone ]
< 기능 >​
ㆍ사용자 인터페이스 제공​
ㆍ감정 분석 결과 출력​
ㆍ실시간 웹캠 화면 기반 집중도 레벨/차트/경고 출력​
ㆍ음악 스트리밍 및 추천 기능 제공​
ㆍ감정 및 경고 기록 제공

< 다루는 정보 >​
ㆍ사용자 로그인 상태​
ㆍ감정 분석 결과​
ㆍ집중도 레벨 데이터

< 기록할 정보 >​
ㆍ감정 분석 결과 기록​
ㆍ집중도 레벨 기록

< 시점 >​
ㆍ감정 분석 결과 기록: 매번 하나의 음악 재생이 끝날 시​
ㆍ집중도 레벨 기록: 실시간

----------------------------------------------------------

## :white_medium_square: 개발 환경
![개발환경 표](https://github.com/user-attachments/assets/1b95fc89-2bb1-4515-be92-6f8c7e65aea6)

----------------------------------------------------------

## :white_medium_square: 팀원 구성, 역할 분담
<table>
  <tr>
    <td align="center"><a href="https://github.com/dkk011"><img src="https://avatars.githubusercontent.com/u/171115956?v=4" width="100px;" alt=""/><br /><sub><b>공덕규</b></sub></a><br />Back-end</td>
    <td align="center"><a href="https://github.com/frondais"><img src="https://avatars.githubusercontent.com/u/192973311?v=4" width="100px;" alt=""/><br /><sub><b>정이슬</b></sub></a><br />Front-end</td>
    <td align="center"><a href="https://github.com/IN-SUN02"><img src="https://avatars.githubusercontent.com/u/120308825?v=4" width="100px;" alt=""/><br /><sub><b>장인선</b></sub></a><br />Front-end</td>
    <td align="center"><a href="https://github.com/GGeunit"><img src="https://avatars.githubusercontent.com/u/165870924?v=4" width="100px;" alt=""/><br /><sub><b>최민근</b></sub></a><br />Back-end</td>
  </tr>
</table>

----------------------------------------------------------

## :white_medium_square: 개발 기간 및 작업 관리
**개발 기간**
- 전체 개발 기간 : 2024.08.11 ~ 
- 기획 기간 : 2024.08.11 ~ 2024.11.28
- 어플 구현 : 2024..11.29 ~ 2025.03.06
- JETSON NANO 이용 구현 : 2025.03.07 ~ <br>

**작업 관리**
- 주 3~4회 정기적인 모임을 가져 작업을 진행하고, GitHub를 통해 프로젝트를 공유하며 기록함

----------------------------------------------------------

## :white_medium_square: 추가 사항
- 추후 JETSON NANO 이용 구현이 필요함
- ui 수정이 필요함

----------------------------------------------------------

## :white_medium_square: 프로젝트 후기
공덕규 : ...<br>

정이슬 : ...<br>

장인선 : ... <br>

최민근 : ...


